{"ast":null,"code":"import axios from \"axios\";\nimport { addFile, setFiles, removeFromFiles, renameFileReducer, updateFile } from \"../reducers/fileReducer\";\nimport { addUploadFile, changeUploadFile, removeUploadFile } from \"../reducers/uploadReducer\";\nexport function getFiles(dirId) {\n  return async dispatch => {\n    const res = await axios.get(`http://localhost:5000/api/drive/file/${dirId ? dirId : ''}`, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      }\n    });\n    dispatch(setFiles(res.data));\n  };\n}\nexport function createDir(dirId, dirName) {\n  return async dispatch => {\n    const res = await axios.post(`http://localhost:5000/api/drive/folder`, {\n      name: dirName,\n      parentId: dirId,\n      type: 'dir'\n    }, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      }\n    });\n\n    if (res.data.message) {\n      return res.data.message;\n    }\n\n    dispatch(addFile(res.data));\n    return res.data;\n  };\n}\nexport function uploadFile(dirId, file) {\n  return async dispatch => {\n    const data = new FormData();\n    data.append('file', file);\n    data.append('parentId', dirId);\n    const uploadFile = {\n      id: Date.now(),\n      name: file.name,\n      progress: 0\n    };\n    dispatch(addUploadFile(uploadFile));\n    const res = await axios.post('http://localhost:5000/api/drive/file', data, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      },\n      onUploadProgress: progressEvent => {\n        const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\n\n        if (totalLength) {\n          uploadFile.progress = Math.round(progressEvent.loaded * 100 / totalLength);\n          dispatch(changeUploadFile(uploadFile));\n        }\n      }\n    });\n\n    if (res.data.message) {\n      return res.data.message;\n    }\n\n    dispatch(addFile(res.data));\n  };\n}\nexport function updateFilePath(childFile, parentFile) {\n  return async dispatch => {\n    const data = {\n      childFile,\n      parentFile\n    };\n    const res = await axios.put('http://localhost:5000/api/drive/file/move', data, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      }\n    });\n    dispatch(removeFromFiles(childFile)); // dispatch(updateFile(res.data));\n\n    dispatch(getFiles(childFile.parentId));\n  };\n} // export function updateFolderPath(childFile, parentFile) {\n//     return async dispatch => {\n//         console.log(childFile);\n//         const data = {\n//             childFile,\n//             parentFile\n//         };\n//         const res = await axios.put('http://localhost:5000/api/drive/folder/move', data, {\n//             headers: {\n//                 Authorization: `Bearer ${localStorage.getItem('token')}`\n//             }\n//         });\n//         dispatch(removeFromFiles(childFile));\n//     }\n// }\n\nexport function removeFile(file) {\n  return async dispatch => {\n    console.log(file);\n    const res = await axios.delete('http://localhost:5000/api/drive/file', {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      },\n      data: file\n    });\n    dispatch(removeFromFiles(file));\n  };\n}\nexport function renameFile({ ...data\n}) {\n  return async dispatch => {\n    const res = await axios.put('http://localhost:5000/api/drive/file/name', data, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      }\n    });\n    dispatch(renameFileReducer(data));\n  };\n}\nexport function downloadFile(file) {\n  return async dispatch => {\n    console.log(file);\n    const data = {\n      file\n    };\n    const res = await fetch(`http://localhost:5000/api/drive/file/download?_id=${file._id}`, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      }\n    });\n\n    if (res.status === 200) {\n      const blob = await res.blob();\n      const downloadUrl = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = downloadUrl;\n      link.download = file.name;\n      document.body.appendChild(link);\n      link.click();\n      link.remove();\n    }\n  };\n}\nexport function uploadFolder(files, parentId) {\n  return async dispatch => {\n    const data = new FormData();\n\n    for (let i = 0; i < files.length; i++) {\n      data.append(`files[${i}]`, files[i]);\n      data.append(`files[${i}]`, files[i].webkitRelativePath.split('/').slice(0, -1).join('/'));\n    }\n\n    ;\n    data.append('parentId', parentId);\n    const uploadFile = {\n      id: Date.now(),\n      name: '—',\n      progress: 0\n    };\n    dispatch(addUploadFile(uploadFile));\n    const res = await axios.post('http://localhost:5000/api/drive/files', data, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      },\n      onUploadProgress: progressEvent => {\n        const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\n\n        if (totalLength) {\n          uploadFile.progress = Math.round(progressEvent.loaded * 100 / totalLength);\n          dispatch(changeUploadFile(uploadFile));\n        }\n      }\n    });\n\n    if (res.data.message) {\n      return res.data.message;\n    }\n\n    dispatch(addFile(res.data));\n  };\n}\nexport function getStatic(file) {\n  return async dispatch => {\n    const ext = file.name.split('.').pop();\n\n    if (ext === 'mov' || ext === 'mp4') {\n      const newWin = window.open();\n      const player = document.createElement('video');\n      player.style = {\n        marginLeft: 'auto',\n        marginRight: 'auto'\n      };\n      player.controls = 'true';\n      player.src = `http://localhost:5000/?userId=${file.userId}&_id=${file._id}&ext=${ext}`;\n      newWin.document.body.append(player);\n    } else if (ext === 'mp3' || ext === 'wav') {\n      const newWin = window.open();\n      const player = document.createElement('audio');\n      player.style = {\n        top: '100px'\n      };\n      player.controls = 'true';\n      player.id = 'audio-player';\n      newWin.document.body.append(player);\n      const source = document.createElement('source');\n      source.id = 'aim';\n      source.type = `audio/${ext}`;\n      source.src = `http://localhost:5000/?userId=${file.userId}&_id=${file._id}&ext=${ext}`;\n      newWin.document.getElementById('audio-player').appendChild(source);\n    } else {\n      window.open(`http://localhost:5000/?userId=${file.userId}&_id=${file._id}&ext=${ext}`, '_blank');\n    }\n  };\n}","map":{"version":3,"sources":["/Users/admin/Desktop/DataArt/CloudDrive/front/src/actions/file.js"],"names":["axios","addFile","setFiles","removeFromFiles","renameFileReducer","updateFile","addUploadFile","changeUploadFile","removeUploadFile","getFiles","dirId","dispatch","res","get","headers","Authorization","localStorage","getItem","data","createDir","dirName","post","name","parentId","type","message","uploadFile","file","FormData","append","id","Date","now","progress","onUploadProgress","progressEvent","totalLength","lengthComputable","total","target","getResponseHeader","Math","round","loaded","updateFilePath","childFile","parentFile","put","removeFile","console","log","delete","renameFile","downloadFile","fetch","_id","status","blob","downloadUrl","window","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","click","remove","uploadFolder","files","i","length","webkitRelativePath","split","slice","join","getStatic","ext","pop","newWin","open","player","style","marginLeft","marginRight","controls","src","userId","top","source","getElementById"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport {\n    addFile,\n    setFiles,\n    removeFromFiles,\n    renameFileReducer,\n    updateFile\n} from \"../reducers/fileReducer\";\nimport { addUploadFile, changeUploadFile, removeUploadFile } from \"../reducers/uploadReducer\";\n\nexport function getFiles(dirId) {\n    return async dispatch => {\n        const res = await axios.get(`http://localhost:5000/api/drive/file/${dirId ? dirId : ''}`, {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem('token')}`\n            }\n        });\n        dispatch(setFiles(res.data));\n    }\n}\n\nexport function createDir(dirId, dirName) {\n    return async dispatch => {\n        const res = await axios.post(`http://localhost:5000/api/drive/folder`, {\n            name: dirName,\n            parentId: dirId,\n            type: 'dir'\n        },\n        {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem('token')}`\n            }\n        });\n        if(res.data.message) {\n            return res.data.message;\n        }\n        dispatch(addFile(res.data));\n        return res.data;\n    }\n}\n\nexport function uploadFile(dirId, file) {\n    return async dispatch => {\n        const data = new FormData();\n        data.append('file', file);\n        data.append('parentId', dirId);\n        const uploadFile = {\n            id: Date.now(),\n            name: file.name,\n            progress: 0\n        };\n        dispatch(addUploadFile(uploadFile));\n        const res = await axios.post('http://localhost:5000/api/drive/file', data, {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem('token')}`\n            },\n            onUploadProgress: progressEvent => {\n                const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\n                if(totalLength) {\n                    uploadFile.progress = Math.round((progressEvent.loaded * 100) / totalLength);\n                    dispatch(changeUploadFile(uploadFile));\n                }\n            }\n        });\n        if(res.data.message) {\n            return res.data.message;\n        }\n        dispatch(addFile(res.data));\n    }\n}\n\nexport function updateFilePath(childFile, parentFile) {\n    return async dispatch => {\n        const data = {\n            childFile,\n            parentFile\n        };\n        const res = await axios.put('http://localhost:5000/api/drive/file/move', data, {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem('token')}`\n            }\n        });\n        dispatch(removeFromFiles(childFile));\n        // dispatch(updateFile(res.data));\n        dispatch(getFiles(childFile.parentId));\n    }\n}\n\n// export function updateFolderPath(childFile, parentFile) {\n//     return async dispatch => {\n//         console.log(childFile);\n//         const data = {\n//             childFile,\n//             parentFile\n//         };\n//         const res = await axios.put('http://localhost:5000/api/drive/folder/move', data, {\n//             headers: {\n//                 Authorization: `Bearer ${localStorage.getItem('token')}`\n//             }\n//         });\n//         dispatch(removeFromFiles(childFile));\n//     }\n// }\n\nexport function removeFile(file) {\n    return async dispatch => {\n        console.log(file);\n        const res = await axios.delete('http://localhost:5000/api/drive/file', {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem('token')}`\n            },\n            data: file\n        });\n        dispatch(removeFromFiles(file));\n    }\n}\n\nexport function renameFile({...data}) {\n    return async dispatch => {\n        const res = await axios.put('http://localhost:5000/api/drive/file/name', data, {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem('token')}`\n            }\n        });\n        dispatch(renameFileReducer(data));\n    }\n}\n\nexport function downloadFile(file) {\n    return async dispatch => {\n        console.log(file);\n        const data = {\n            file\n        }\n        const res = await fetch(`http://localhost:5000/api/drive/file/download?_id=${file._id}`, {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem('token')}`\n            }\n        });\n        if(res.status === 200) {\n            const blob = await res.blob();\n            const downloadUrl = window.URL.createObjectURL(blob);\n            const link = document.createElement('a');\n            link.href = downloadUrl;\n            link.download = file.name;\n            document.body.appendChild(link);\n            link.click();\n            link.remove();\n        }\n    }\n}\n\nexport function uploadFolder(files, parentId) {\n    return async dispatch => {\n        const data = new FormData();\n        for(let i = 0; i < files.length; i++) {\n            data.append(`files[${i}]`, files[i]);\n            data.append(`files[${i}]`, files[i].webkitRelativePath.split('/').slice(0, -1).join('/'));\n        };\n        data.append('parentId', parentId);\n        const uploadFile = {\n            id: Date.now(),\n            name: '—',\n            progress: 0\n        };\n        dispatch(addUploadFile(uploadFile));\n        const res = await axios.post('http://localhost:5000/api/drive/files', data, {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem('token')}`\n            },\n            onUploadProgress: progressEvent => {\n                const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\n                if(totalLength) {\n                    uploadFile.progress = Math.round((progressEvent.loaded * 100) / totalLength);\n                    dispatch(changeUploadFile(uploadFile));\n                }\n            }\n        });\n        if(res.data.message) {\n            return res.data.message;\n        }\n        dispatch(addFile(res.data));\n    }\n}\n\nexport function getStatic(file) {\n    return async dispatch => {\n        const ext = file.name.split('.').pop();\n        if(ext === 'mov' || ext === 'mp4') {\n            const newWin = window.open();\n            const player = document.createElement('video');\n            player.style = {\n                marginLeft: 'auto',\n                marginRight: 'auto'\n            }\n            player.controls = 'true';\n            player.src = `http://localhost:5000/?userId=${file.userId}&_id=${file._id}&ext=${ext}`;\n            newWin.document.body.append(player);\n        } else if(ext === 'mp3' || ext === 'wav') {\n            const newWin = window.open();\n            const player = document.createElement('audio');\n            player.style = {\n                top: '100px'\n            }\n            player.controls = 'true';\n            player.id = 'audio-player';\n            newWin.document.body.append(player);\n            const source = document.createElement('source');\n            source.id = 'aim';\n            source.type = `audio/${ext}`;\n            source.src = `http://localhost:5000/?userId=${file.userId}&_id=${file._id}&ext=${ext}`;\n            newWin.document.getElementById('audio-player').appendChild(source);\n        } else {\n            window.open(`http://localhost:5000/?userId=${file.userId}&_id=${file._id}&ext=${ext}`, '_blank');\n        }\n    }\n}"]},"metadata":{},"sourceType":"module"}